import{r as s,j as e,u as C,c as _,s as I,g as D,l as T,L as E}from"./index-Dr3-2KAD.js";import{R as S}from"./job-BQIvpYU_.js";function w({label:n,files:l,onFilesChange:r}){const c=s.useRef(null),[i,o]=s.useState(!1),m=s.useCallback(a=>{if(!a)return;const t=Array.from(a).filter(d=>d.type==="application/pdf");r([...l,...t])},[l,r]),b=s.useCallback(a=>{a.preventDefault(),o(!1),m(a.dataTransfer.files)},[m]),p=s.useCallback(a=>{a.preventDefault(),o(!0)},[]),f=s.useCallback(a=>{a.preventDefault(),o(!1)},[]),u=s.useCallback(a=>{r(l.filter((t,d)=>d!==a))},[l,r]);return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:n}),e.jsxs("div",{onClick:()=>{var a;return(a=c.current)==null?void 0:a.click()},onDrop:b,onDragOver:p,onDragLeave:f,className:`flex flex-col items-center justify-center rounded-lg border-2 border-dashed px-4 py-6 cursor-pointer transition-colors ${i?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Drop PDF files here or click to browse"}),e.jsx("input",{ref:c,type:"file",multiple:!0,accept:".pdf",className:"hidden",onChange:a=>{m(a.target.files),a.target.value=""}})]}),l.length>0&&e.jsx("ul",{className:"mt-2 space-y-1",children:l.map((a,t)=>e.jsxs("li",{className:"flex items-center justify-between text-sm text-gray-600 py-0.5",children:[e.jsx("span",{className:"truncate",children:a.name}),e.jsx("button",{type:"button",onClick:d=>{d.stopPropagation(),u(t)},className:"ml-2 text-gray-400 hover:text-gray-600 shrink-0",children:"Ã—"})]},`${a.name}-${t}`))})]})}const G=Object.entries(S);function R({isOpen:n,onClose:l}){const r=C(),[c,i]=s.useState([]),[o,m]=s.useState([]),[b,p]=s.useState("none"),[f,u]=s.useState(!1),[a,t]=s.useState(null),d=s.useCallback(()=>{i([]),m([]),p("none"),t(null)},[]),j=s.useCallback(()=>{d(),l()},[d,l]),y=s.useCallback(async()=>{if(!(c.length===0||o.length===0)){u(!0),t(null);try{const x=await _(c,o,b);d(),l(),r({to:"/compare/$jobId",params:{jobId:x.job_id}})}catch(x){t(x instanceof Error?x.message:"Upload failed")}finally{u(!1)}}},[c,o,b,r,l,d]);return n?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:j}),e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"New Comparison"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsx(w,{label:"Reference PDFs",files:c,onFilesChange:i}),e.jsx(w,{label:"Test PDFs",files:o,onFilesChange:m})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Report Type"}),e.jsx("select",{value:b,onChange:x=>p(x.target.value),className:"block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",children:G.map(([x,N])=>e.jsx("option",{value:x,children:N},x))})]}),a&&e.jsx("p",{className:"text-sm text-red-600 mb-4",children:a}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:j,className:"px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900",children:"Cancel"}),e.jsx("button",{type:"button",onClick:y,disabled:f||c.length===0||o.length===0,className:"px-4 py-2 text-sm font-medium text-white bg-gray-900 rounded-md hover:bg-gray-800 disabled:bg-gray-300 disabled:cursor-not-allowed",children:f?"Uploading...":"Start Comparison"})]})]})]}):null}function F({isOpen:n,onClose:l}){const[r,c]=s.useState(""),[i,o]=s.useState(""),[m,b]=s.useState(""),[p,f]=s.useState(""),[u,a]=s.useState(!1),[t,d]=s.useState(!1),[j,y]=s.useState(null);s.useEffect(()=>{if(!n)return;let h=!1;async function k(){a(!0),y(null);try{const g=await D();if(h)return;c(g.section_generic),o(g.global_template),b(g.section_generic),f(g.global_template)}catch(g){h||y(g instanceof Error?g.message:"Failed to load instructions")}finally{h||a(!1)}}return k(),()=>{h=!0}},[n]);const x=s.useMemo(()=>r!==m||i!==p,[r,m,i,p]),N=s.useCallback(async()=>{if(x){d(!0),y(null);try{await I(r,i),l()}catch(h){y(h instanceof Error?h.message:"Failed to save instructions")}finally{d(!1)}}},[x,r,i,l]);return n?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-950/50 backdrop-blur-[1px]",onClick:l}),e.jsxs("div",{className:"relative w-full max-w-5xl rounded-2xl border border-slate-200 bg-white shadow-2xl",children:[e.jsxs("div",{className:"border-b border-slate-200 px-6 py-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"General Analysis Instructions"}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Update shared instructions used across section-level and global analysis."})]}),e.jsxs("div",{className:"grid gap-5 p-6 lg:grid-cols-2",children:[e.jsxs("section",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-800",children:"Section Generic Instructions"}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Maps to ",e.jsx("code",{children:"section_instructions.md"})," under ",e.jsx("code",{children:"## Generic"}),"."]}),e.jsx("textarea",{value:r,onChange:h=>c(h.target.value),className:"h-64 w-full resize-none rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm outline-none transition focus:border-blue-500 focus:ring-2 focus:ring-blue-200",spellCheck:!1,disabled:u||t})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-800",children:"Global Analysis Template"}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Keep markdown structure and checklist headings (",e.jsx("code",{children:"### ..."}),") for stable output."]}),e.jsx("textarea",{value:i,onChange:h=>o(h.target.value),className:"h-64 w-full resize-none rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm outline-none transition focus:border-blue-500 focus:ring-2 focus:ring-blue-200",spellCheck:!1,disabled:u||t})]})]}),j&&e.jsx("p",{className:"px-6 pb-2 text-sm text-red-600",children:j}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-slate-200 px-6 py-4",children:[e.jsx("button",{type:"button",onClick:l,className:"rounded-md px-4 py-2 text-sm font-medium text-slate-600 hover:text-slate-900",disabled:t,children:"Cancel"}),e.jsx("button",{type:"button",onClick:N,disabled:u||t||!x,className:"rounded-md bg-slate-900 px-4 py-2 text-sm font-medium text-white transition hover:bg-slate-800 disabled:cursor-not-allowed disabled:bg-slate-300",children:t?"Saving...":"Save Instructions"})]})]})]}):null}const L={idle:"bg-slate-100 text-slate-600",running:"bg-blue-100 text-blue-700",done:"bg-green-100 text-green-700",failed:"bg-red-100 text-red-700"};function v({value:n}){return e.jsx("span",{className:`inline-flex rounded-full px-2 py-0.5 text-xs font-medium ${L[n]}`,children:n})}function O(n){const l=new Date(n);return Number.isNaN(l.getTime())?n:new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(l)}function $(){const[n,l]=s.useState(!1),[r,c]=s.useState(!1),[i,o]=s.useState([]),[m,b]=s.useState(!0),[p,f]=s.useState(null),u=s.useCallback(async()=>{try{f(null);const t=await T();o(t)}catch(t){f(t instanceof Error?t.message:"Failed to load runs")}finally{b(!1)}},[]);s.useEffect(()=>{u();const t=setInterval(u,5e3);return()=>clearInterval(t)},[u]);const a=i.length>0;return e.jsxs("div",{className:"flex-1 overflow-y-auto bg-white",children:[e.jsxs("div",{className:"mx-auto w-full max-w-7xl px-6 py-6",children:[e.jsxs("header",{className:"flex flex-col gap-4 border-b border-slate-200 pb-5 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-900",children:"Comparison Runs"}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Start new comparisons, revisit previous runs, and maintain shared analysis instructions."})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:justify-end",children:[e.jsx("button",{onClick:()=>c(!0),className:"rounded-md border border-slate-300 bg-white px-4 py-2 text-sm font-medium text-slate-700 transition hover:border-slate-400 hover:text-slate-900",children:"Edit General Instructions"}),e.jsx("button",{onClick:()=>l(!0),className:"rounded-md bg-slate-900 px-4 py-2 text-sm font-medium text-white transition hover:bg-slate-800",children:"New Comparison"})]})]}),p&&e.jsx("p",{className:"mt-4 text-sm text-red-600",children:p}),e.jsxs("section",{className:"mt-5",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-wide text-slate-600",children:"Run History"}),e.jsx("div",{className:"text-xs text-slate-500",children:m?"Refreshing...":`${i.length} run${i.length===1?"":"s"}`})]}),!m&&!a&&!p&&e.jsx("div",{className:"py-10 text-center text-sm text-slate-600",children:"No comparisons have been started yet."}),a&&e.jsx("div",{className:"overflow-x-auto border border-slate-200",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{className:"text-left text-xs uppercase tracking-wide text-slate-500",children:[e.jsx("th",{className:"px-5 py-3 font-medium",children:"Created"}),e.jsx("th",{className:"px-5 py-3 font-medium",children:"Job"}),e.jsx("th",{className:"px-5 py-3 font-medium",children:"Report"}),e.jsx("th",{className:"px-5 py-3 font-medium",children:"Pairs"}),e.jsx("th",{className:"px-5 py-3 font-medium",children:"Unmatched"}),e.jsx("th",{className:"px-5 py-3 font-medium",children:"Section Detect"}),e.jsx("th",{className:"px-5 py-3 font-medium",children:"Global"}),e.jsx("th",{className:"px-5 py-3 font-medium",children:"Section"}),e.jsx("th",{className:"px-5 py-3 font-medium",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 bg-white",children:i.map(t=>e.jsxs("tr",{className:"text-sm text-slate-700",children:[e.jsx("td",{className:"px-5 py-3 whitespace-nowrap",children:O(t.created_at)}),e.jsx("td",{className:"px-5 py-3 font-mono text-xs text-slate-600",title:t.job_id,children:t.job_id}),e.jsx("td",{className:"px-5 py-3 whitespace-nowrap",children:S[t.report_type]??t.report_type}),e.jsx("td",{className:"px-5 py-3 whitespace-nowrap",children:t.pairs.length}),e.jsxs("td",{className:"px-5 py-3 whitespace-nowrap",children:["R ",t.unmatched_reference.length," / T ",t.unmatched_test.length]}),e.jsx("td",{className:"px-5 py-3 whitespace-nowrap",children:e.jsx(v,{value:t.analysis_status})}),e.jsx("td",{className:"px-5 py-3 whitespace-nowrap",children:e.jsx(v,{value:t.global_analysis_status})}),e.jsx("td",{className:"px-5 py-3 whitespace-nowrap",children:e.jsx(v,{value:t.section_analysis_status})}),e.jsx("td",{className:"px-5 py-3 whitespace-nowrap",children:e.jsx(E,{to:"/compare/$jobId",params:{jobId:t.job_id},className:"inline-flex rounded-md border border-slate-300 px-3 py-1.5 text-xs font-medium text-slate-700 transition hover:border-slate-400 hover:text-slate-900",children:"Open"})})]},t.job_id))})]})})]})]}),e.jsx(R,{isOpen:n,onClose:()=>l(!1)}),e.jsx(F,{isOpen:r,onClose:()=>c(!1)})]})}export{$ as component};
